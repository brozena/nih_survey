NIH BD/Finhealth Survey - Models
================

``` r
library(tidyverse)
library(lme4)
library(ordinal)
library(mclogit)
library(nnet)
library(psych)
library(ggstats)
library(ggthemes)
library(performance)
library(marginaleffects)
library(sjPlot)
library(kableExtra)
library(flextable)
library(xtable)
library(scales)
```

## Load data

``` r
load('data/NIH_survey.Rdata')
```

## Descriptive statistics

### Means of outcome for all vignettes

``` r
tab <- long %>% 
summarize(
          Mean = mean(y, na.rm = TRUE),
          Median = median(y, na.rm = TRUE),
          SD = sd(y, na.rm = TRUE),
          ci = list(mean_cl_normal(y, conf.int = .95)),
          obs = n_distinct(participant)
) %>% unnest(c(ci))
theme_vanilla(flextable(tab)) %>% colformat_double(digits = 2)
```

<img src="03.models_files/figure-gfm/unnamed-chunk-3-1.png" width="1050" />

### Means of outcome for each vignette

``` r
tab_vig <- long %>% group_by(actors, context, moodstate) %>%
summarize(
          Mean = mean(y, na.rm = TRUE),
          Median = median(y, na.rm = TRUE),
          SD = sd(y, na.rm = TRUE),
          ci = list(mean_cl_normal(y, conf.int = .95)),
          obs = n_distinct(participant)
) %>% unnest(c(ci))
print(xtable(tab_vig, type='latex', tabular.environment='longtable'), file='tables/tbl-vignette-descriptives.tex')
theme_vanilla(flextable(tab_vig)) %>% colformat_double(digits = 2)
```

<img src="03.models_files/figure-gfm/unnamed-chunk-4-1.png" width="1585" />

## Modeling

### Unconditional means

``` r
unconditional.means <- lmer(y ~ 1 + (1|participant) + (1|item), data=long)
summary(unconditional.means)
```

    ## Linear mixed model fit by REML ['lmerMod']
    ## Formula: y ~ 1 + (1 | participant) + (1 | item)
    ##    Data: long
    ## 
    ## REML criterion at convergence: 41202.1
    ## 
    ## Scaled residuals: 
    ##     Min      1Q  Median      3Q     Max 
    ## -3.3243 -0.6615 -0.0134  0.6369  4.1194 
    ## 
    ## Random effects:
    ##  Groups      Name        Variance Std.Dev.
    ##  participant (Intercept) 4.257    2.063   
    ##  item        (Intercept) 1.583    1.258   
    ##  Residual                4.869    2.207   
    ## Number of obs: 8982, groups:  participant, 499; item, 18
    ## 
    ## Fixed effects:
    ##             Estimate Std. Error t value
    ## (Intercept)   4.1795     0.3115   13.42

``` r
performance::icc(unconditional.means, by_group=TRUE)
```

    ## # ICC by Group
    ## 
    ## Group       |   ICC
    ## -------------------
    ## participant | 0.398
    ## item        | 0.148

### Primary model

``` r
m1 <- lmer(y ~ 1 + actors + context + moodstate + age + gender + education + ethnicity + hispanic + diagnosis_subtype + hospitalization + banked + savings + trust_clinician + trust_carepartner + trust_bank + cfpb_score + care_partner_help + bfi_agreeableness + (1|participant) + (1|item), data=long)
```

``` r
car::Anova(m1, type=3)
```

    ## Analysis of Deviance Table (Type III Wald chisquare tests)
    ## 
    ## Response: y
    ##                     Chisq Df Pr(>Chisq)    
    ## (Intercept)        0.7689  1     0.3806    
    ## actors            57.0323  2  4.127e-13 ***
    ## context           64.1987  2  1.147e-14 ***
    ## moodstate          4.2265  1     0.0398 *  
    ## age                2.5410  6     0.8638    
    ## gender             7.5825  4     0.1081    
    ## education          2.7307  7     0.9087    
    ## ethnicity          3.2288  5     0.6648    
    ## hispanic           0.2299  1     0.6316    
    ## diagnosis_subtype  2.4247  4     0.6582    
    ## hospitalization    2.8569  2     0.2397    
    ## banked             0.4523  2     0.7976    
    ## savings            0.6926  2     0.7073    
    ## trust_clinician   23.6421  4  9.421e-05 ***
    ## trust_carepartner  2.6355  4     0.6206    
    ## trust_bank        43.7216  4  7.330e-09 ***
    ## cfpb_score         0.7315  1     0.3924    
    ## care_partner_help 26.7831  2  1.528e-06 ***
    ## bfi_agreeableness  0.0000  1     0.9988    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

### Main effects

#### ❌ H1.1: Comfort ratings will be lower during stable periods vs. symptomatic periods

``` r
# pairwise test
# m2 is main effects model

m2 <- lmer(y ~ 1 + actors + context + moodstate + diagnosis_subtype + (1|participant) + (1|item), data=long)
saveRDS(m2, file='models/m2.rds')

car::Anova(m2, type=3)
```

    ## Analysis of Deviance Table (Type III Wald chisquare tests)
    ## 
    ## Response: y
    ##                     Chisq Df Pr(>Chisq)    
    ## (Intercept)       28.7023  1  8.441e-08 ***
    ## actors            57.4884  2  3.285e-13 ***
    ## context           65.3403  2  6.479e-15 ***
    ## moodstate          4.1508  1    0.04162 *  
    ## diagnosis_subtype  1.3136  4    0.85907    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
hypotheses(avg_predictions(m2, by='moodstate', re.form=NULL))
```

    ## 
    ##  Term Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %
    ##    b1     3.97      0.174 22.8   <0.001 380.4  3.63   4.31
    ##    b2     4.39      0.174 25.3   <0.001 465.1  4.05   4.73

``` r
hypotheses(avg_predictions(m2, by='moodstate', re.form=NULL), 'b2=b1')
```

    ## 
    ##  Hypothesis Estimate Std. Error    z Pr(>|z|)   S  2.5 % 97.5 %
    ##       b2=b1    0.424      0.208 2.04   0.0416 4.6 0.0161  0.832

``` r
avg_predictions(m2, by='diagnosis_subtype', re.form=NULL)
```

    ## 
    ##                         diagnosis_subtype Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##  Bipolar Disorder Not Otherwise Specified     4.11      0.220 18.65   <0.001 255.3  3.68   4.54
    ##  Cyclothymia                                  3.69      0.718  5.13   <0.001  21.7  2.28   5.09
    ##  I do not know                                4.01      0.352 11.39   <0.001  97.5  3.32   4.70
    ##  Type I                                       4.17      0.223 18.66   <0.001 255.7  3.73   4.60
    ##  Type II                                      4.28      0.177 24.15   <0.001 425.7  3.93   4.62
    ## 
    ## Type:  response

``` r
# Figure caption: Overall comfort ratings were lower during euthymic periods when compared to symptomatic periods.
ggsave('plots/H1.1_main_moodstate.png', width=9, height=7, units='in', dpi=600, plot_predictions(m2, by=c('diagnosis_subtype', 'moodstate')) +
  labs(x='Diagnosis Subtype', y='Rating', color='Mood State') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

#### ✅ H2.1: Among intervention levels, comfort ratings will be lowest for spending restrictions

``` r
# calculate as the difference between an estimate and the mean of all estimates

avg_predictions(m2, by='context', re.form=NULL, hypothesis = difference~meandev)
```

    ## 
    ##                               Hypothesis Estimate Std. Error     z Pr(>|z|)    S  2.5 % 97.5 %
    ##  (48-hour Spending Restriction) - Mean     -1.109      0.147 -7.53   <0.001 44.2 -1.397  -0.82
    ##  (Help with Planning & Budgeting) - Mean    0.927      0.147  6.30   <0.001 31.7  0.639   1.22
    ##  (Share Spending Details) - Mean            0.181      0.147  1.23    0.218  2.2 -0.107   0.47
    ## 
    ## Type:  response

``` r
# Figure caption: Respondents were least comfortable overall with a hypothetical 48-hour spending restriction intervention.
ggsave('plots/H2.1_main_context.png', width=9, height=7, units='in', dpi=600, plot_predictions(m2, by=c('context')) +
    labs(x='Intervention Context', y='Rating') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

#### ✅ H3.1: Comfort will be highest for care partners

``` r
# as meandev, like above

hypotheses(avg_predictions(m2, variables='actors', re.form=NULL), multcomp='holm')
```

    ## 
    ##  Term Estimate Std. Error    z Pr(>|z|)   S 2.5 % 97.5 %
    ##    b1     3.11      0.203 15.3   <0.001 Inf  2.63   3.59
    ##    b2     4.99      0.203 24.6   <0.001 Inf  4.50   5.47
    ##    b3     4.44      0.203 21.9   <0.001 Inf  3.96   4.93

``` r
# Figure caption Respondents were most comfortable sharing financial data with care partners.
ggsave('plots/H3.1_main_actors.png', width=9, height=7, units='in', dpi=600, plot_predictions(m2, by='actors') +
  labs(x='Actors', y='Rating') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

### Interaction effects

#### ❌ H1.2: Among intervention levels, comfort ratings will be highest for shared spending behaviors during mood episodes

``` r
# m3 is interaction between intervention context and mood state

m3 <- lmer(y ~ actors + context * moodstate + diagnosis_subtype + (1|participant) + (1|item), data=long)
saveRDS(m3, file='models/m3.rds')
avg_predictions(m3, by=c('moodstate', 'context'), hypothesis=difference~meandev, re.form=NULL)
```

    ## 
    ##                                           Hypothesis Estimate Std. Error       z Pr(>|z|)    S   2.5 % 97.5 %
    ##  (Euthymic 48-hour Spending Restriction) - Mean        -1.723      0.151 -11.383   <0.001 97.3 -2.0199 -1.427
    ##  (Euthymic Help with Planning & Budgeting) - Mean       0.984      0.151   6.501   <0.001 33.5  0.6875  1.281
    ##  (Euthymic Share Spending Details) - Mean               0.103      0.151   0.681   0.4959  1.0 -0.1936  0.400
    ##  (Symptomatic 48-hour Spending Restriction) - Mean     -0.494      0.151  -3.264   0.0011  9.8 -0.7908 -0.197
    ##  (Symptomatic Help with Planning & Budgeting) - Mean    0.871      0.151   5.751   <0.001 26.7  0.5739  1.167
    ##  (Symptomatic Share Spending Details) - Mean            0.259      0.151   1.713   0.0866  3.5 -0.0373  0.556
    ## 
    ## Type:  response

``` r
# Figure caption: Respondents were most comfortable seeking help with planning and budgeting, regardless of the presence of a mood episode.
ggsave('plots/H1.2_interaction_context_moodstate.png', width=9, height=7, units='in', dpi=600, plot_predictions(m3, by=c('context', 'moodstate')) +
  labs(x='Intervention Context', y='Rating', color='Mood State') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

#### ✅ H1.3: Among intervention levels, comfort ratings for spending restrictions will be higher during mood episodes vs. during stable periods (H0: ‘b2=b5’)

``` r
avg_predictions(m3, by=c('moodstate', 'context'))
```

    ## 
    ##    moodstate                        context Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %
    ##  Euthymic    48-hour Spending Restriction       2.46       0.19 12.9   <0.001 124.6  2.08   2.83
    ##  Euthymic    Help with Planning & Budgeting     5.16       0.19 27.2   <0.001 538.1  4.79   5.54
    ##  Euthymic    Share Spending Details             4.28       0.19 22.5   <0.001 371.5  3.91   4.65
    ##  Symptomatic 48-hour Spending Restriction       3.69       0.19 19.4   <0.001 276.1  3.31   4.06
    ##  Symptomatic Help with Planning & Budgeting     5.05       0.19 26.6   <0.001 514.9  4.68   5.42
    ##  Symptomatic Share Spending Details             4.44       0.19 23.4   <0.001 398.8  4.07   4.81
    ## 
    ## Type:  response

``` r
avg_predictions(m3, by=c('moodstate', 'context'), hypothesis='b2=b5', re.form=NULL)
```

    ## Warning: 
    ## It is essential to check the order of estimates when specifying hypothesis tests using positional indices like b1, b2, etc. The indices of estimates can change depending on the order of rows in the original dataset, user-supplied arguments, model-fitting package, and version of `marginaleffects`.
    ## 
    ## It is also good practice to use assertions that ensure the order of estimates is consistent across different runs of the same code. Example:
    ## 
    ## ```r
    ## mod <- lm(mpg ~ am * carb, data = mtcars)
    ## 
    ## # assertion for safety
    ## p <- avg_predictions(mod, by = 'carb')
    ## stopifnot(p$carb[1] != 1 || p$carb[2] != 2)
    ## 
    ## # hypothesis test
    ## avg_predictions(mod, by = 'carb', hypothesis = 'b1 - b2 = 0')
    ## ```
    ## 
    ## Disable this warning with: `options(marginaleffects_safe = FALSE)`
    ##  This warning appears once per session.

    ## 
    ##  Hypothesis Estimate Std. Error     z Pr(>|z|)   S  2.5 % 97.5 %
    ##       b2=b5    0.114      0.235 0.484    0.628 0.7 -0.346  0.573
    ## 
    ## Type:  response

### Interaction effects with respondent characteristics

#### ✅ H2.2: Evidence of advanced planning behaviors (e.g., psych. advance directive) will lead to higher comfort ratings when sharing spending behaviors

``` r
m4 <- lmer(y ~ actors + context * PAD + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m4, by=c('PAD', 'context'))
```

    ## 
    ##       PAD                        context Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##  No       48-hour Spending Restriction       2.98      0.207 14.42   <0.001 154.2  2.58   3.39
    ##  No       Help with Planning & Budgeting     5.06      0.207 24.47   <0.001 436.8  4.65   5.46
    ##  No       Share Spending Details             4.29      0.207 20.73   <0.001 314.8  3.88   4.69
    ##  Not sure 48-hour Spending Restriction       3.21      0.408  7.86   <0.001  47.9  2.41   4.01
    ##  Not sure Help with Planning & Budgeting     4.83      0.408 11.84   <0.001 105.1  4.03   5.63
    ##  Not sure Share Spending Details             4.11      0.408 10.08   <0.001  76.9  3.31   4.91
    ##  Yes      48-hour Spending Restriction       3.88      0.395  9.81   <0.001  73.0  3.10   4.65
    ##  Yes      Help with Planning & Budgeting     5.86      0.395 14.82   <0.001 162.7  5.09   6.64
    ##  Yes      Share Spending Details             5.37      0.395 13.58   <0.001 137.1  4.60   6.15
    ## 
    ## Type:  response

``` r
avg_predictions(m4, by=c('PAD', 'context'), hypothesis='b9=b3')
```

    ## 
    ##  Hypothesis Estimate Std. Error    z Pr(>|z|)   S 2.5 % 97.5 %
    ##       b9=b3     1.08      0.371 2.92  0.00345 8.2 0.357   1.81
    ## 
    ## Type:  response

``` r
# Figure caption: Respondents with psychiatric advance directives were more comfortable with all hypothetical interventions.
ggsave('plots/H2.2_interaction_context_PAD.png', width=9, height=7, units='in', dpi=600, plot_predictions(m4, by=c('context', 'PAD')) +
  labs(x='Intervention Context', y='Rating', color='Psychiatric Advance\nDirective?') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

#### ✅ H2.3: Evidence of adverse financial events (e.g., prior bankruptcy) will lead to higher comfort ratings of spending restrictions

``` r
m5 <- lmer(y ~ actors + context * bankruptcy_declared + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m5, by=c('bankruptcy_declared', 'context'))
```

    ## 
    ##  bankruptcy_declared                        context Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##             No       48-hour Spending Restriction       3.00      0.206 14.51   <0.001 156.1 2.591   3.40
    ##             No       Help with Planning & Budgeting     5.12      0.206 24.80   <0.001 448.6 4.714   5.52
    ##             No       Share Spending Details             4.36      0.206 21.12   <0.001 326.4 3.954   4.76
    ##             Not sure 48-hour Spending Restriction       2.24      0.672  3.33   <0.001  10.2 0.919   3.55
    ##             Not sure Help with Planning & Budgeting     4.03      0.672  5.99   <0.001  28.9 2.711   5.35
    ##             Not sure Share Spending Details             3.51      0.672  5.23   <0.001  22.5 2.197   4.83
    ##             Yes      48-hour Spending Restriction       3.82      0.346 11.04   <0.001  91.7 3.138   4.49
    ##             Yes      Help with Planning & Budgeting     5.25      0.346 15.18   <0.001 170.4 4.568   5.92
    ##             Yes      Share Spending Details             4.56      0.346 13.19   <0.001 129.5 3.881   5.24
    ## 
    ## Type:  response

``` r
avg_predictions(m5, by=c('bankruptcy_declared', 'context'), hypothesis='b8=b2') 
```

    ## 
    ##  Hypothesis Estimate Std. Error     z Pr(>|z|)   S  2.5 % 97.5 %
    ##       b8=b2    0.127      0.317 0.401    0.688 0.5 -0.494  0.748
    ## 
    ## Type:  response

``` r
# Figure caption:
ggsave('plots/H2.3_interaction_context_bankruptcydeclared.png', width=9, height=7, units='in', dpi=600, plot_predictions(m5, by=c('context', 'bankruptcy_declared')) +
  labs(x='Intervention Context', y='Rating', color='Bankruptcy Declared?') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)

# Exploratory Considering bankruptcy will lead to higher comfort ratings of spending restrictions

m5.1 <- lmer(y ~ actors + context * bankruptcy_considered + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m5.1, by=c('bankruptcy_considered', 'context'))
```

    ## 
    ##  bankruptcy_considered                        context Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##               No       48-hour Spending Restriction       2.89      0.215 13.40   <0.001 133.6  2.46   3.31
    ##               No       Help with Planning & Budgeting     5.11      0.215 23.71   <0.001 410.4  4.68   5.53
    ##               No       Share Spending Details             4.28      0.215 19.89   <0.001 290.1  3.86   4.71
    ##               Not sure 48-hour Spending Restriction       3.14      0.607  5.18   <0.001  22.1  1.96   4.33
    ##               Not sure Help with Planning & Budgeting     4.31      0.607  7.11   <0.001  39.6  3.12   5.50
    ##               Not sure Share Spending Details             3.54      0.607  5.84   <0.001  27.5  2.36   4.73
    ##               Yes      48-hour Spending Restriction       3.45      0.251 13.75   <0.001 140.4  2.95   3.94
    ##               Yes      Help with Planning & Budgeting     5.19      0.251 20.68   <0.001 313.3  4.69   5.68
    ##               Yes      Share Spending Details             4.60      0.251 18.34   <0.001 247.1  4.11   5.09
    ## 
    ## Type:  response

``` r
#avg_predictions(m5.1, by=c('bankruptcy_considered', 'context'), hypothesis='b8=b2') 

# Figure caption:
ggsave('plots/H2.3.1_interaction_context_bankruptcyconsidered.png', width=9, height=7, units='in', dpi=600, plot_predictions(m5.1, by=c('context', 'bankruptcy_considered')) +
  labs(x='Intervention Context', y='Rating', color='Bankruptcy Considered?') +
  scale_x_discrete(labels = label_wrap(10)) +
  theme_light(base_family='Lato')
)
```

#### ✅ H3.2: Higher levels of trust in third parties will be associated with higher comfort ratings for those respective third parties

``` r
# ✅ H3.2.1 High trust in clinicians predicts higher comfort ratings for Actor=Clinician
m6.1 <- lmer(y ~ actors * trust_clinician + context + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m6.1, by=c('trust_clinician', 'actors'))
```

    ## 
    ##             trust_clinician       actors Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##  Extremely difficult        Banks            1.84      0.402  4.59   <0.001  17.8  1.06   2.63
    ##  Extremely difficult        Care Partner     3.72      0.402  9.26   <0.001  65.4  2.93   4.51
    ##  Extremely difficult        Clinicians       2.60      0.402  6.49   <0.001  33.4  1.82   3.39
    ##  Extremely easy             Banks            3.63      0.268 13.55   <0.001 136.5  3.10   4.15
    ##  Extremely easy             Care Partner     5.56      0.268 20.75   <0.001 315.4  5.03   6.08
    ##  Extremely easy             Clinicians       5.72      0.268 21.37   <0.001 334.0  5.20   6.25
    ##  Neither easy nor difficult Banks            2.69      0.323  8.31   <0.001  53.2  2.05   3.32
    ##  Neither easy nor difficult Care Partner     4.32      0.323 13.35   <0.001 132.6  3.68   4.95
    ##  Neither easy nor difficult Clinicians       3.55      0.323 10.98   <0.001  90.8  2.92   4.18
    ##  Somewhat difficult         Banks            2.50      0.299  8.37   <0.001  54.0  1.92   3.09
    ##  Somewhat difficult         Care Partner     4.24      0.299 14.16   <0.001 148.7  3.65   4.82
    ##  Somewhat difficult         Clinicians       3.16      0.299 10.56   <0.001  84.1  2.57   3.74
    ##  Somewhat easy              Banks            3.40      0.229 14.84   <0.001 163.0  2.95   3.85
    ##  Somewhat easy              Care Partner     5.39      0.229 23.48   <0.001 402.7  4.94   5.84
    ##  Somewhat easy              Clinicians       4.82      0.229 21.00   <0.001 322.8  4.37   5.27
    ## 
    ## Type:  response

``` r
avg_predictions(m6.1, by=c('trust_clinician', 'actors'), hypothesis='b6=b3')
```

    ## 
    ##  Hypothesis Estimate Std. Error    z Pr(>|z|)    S 2.5 % 97.5 %
    ##       b6=b3     3.12      0.414 7.54   <0.001 44.3  2.31   3.93
    ## 
    ## Type:  response

``` r
# ✅ H3.2.2 Trust in care partners predicts higher comfort ratings for Actor=Care partner
m6.2 <- lmer(y ~ actors * trust_carepartner + context + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m6.2, by=c('trust_carepartner', 'actors'))
```

    ## 
    ##           trust_carepartner       actors Estimate Std. Error     z Pr(>|z|)     S 2.5 % 97.5 %
    ##  Extremely difficult        Banks            2.28      0.509  4.47   <0.001  17.0  1.28   3.28
    ##  Extremely difficult        Care Partner     2.90      0.509  5.70   <0.001  26.3  1.91   3.90
    ##  Extremely difficult        Clinicians       3.67      0.509  7.20   <0.001  40.6  2.67   4.67
    ##  Extremely easy             Banks            3.35      0.248 13.51   <0.001 135.7  2.87   3.84
    ##  Extremely easy             Care Partner     6.11      0.248 24.60   <0.001 441.7  5.62   6.59
    ##  Extremely easy             Clinicians       4.93      0.248 19.88   <0.001 289.7  4.45   5.42
    ##  Neither easy nor difficult Banks            3.06      0.293 10.46   <0.001  82.7  2.49   3.63
    ##  Neither easy nor difficult Care Partner     4.18      0.293 14.28   <0.001 151.3  3.60   4.75
    ##  Neither easy nor difficult Clinicians       4.01      0.293 13.71   <0.001 139.6  3.44   4.58
    ##  Somewhat difficult         Banks            2.67      0.351  7.59   <0.001  44.9  1.98   3.35
    ##  Somewhat difficult         Care Partner     3.71      0.351 10.55   <0.001  84.0  3.02   4.39
    ##  Somewhat difficult         Clinicians       3.85      0.351 10.96   <0.001  90.5  3.16   4.54
    ##  Somewhat easy              Banks            3.16      0.240 13.16   <0.001 129.0  2.69   3.63
    ##  Somewhat easy              Care Partner     5.04      0.240 20.99   <0.001 322.6  4.57   5.51
    ##  Somewhat easy              Clinicians       4.50      0.240 18.75   <0.001 258.1  4.03   4.97
    ## 
    ## Type:  response

``` r
avg_predictions(m6.2, by=c('trust_carepartner', 'actors'), hypothesis='b5=b2')
```

    ## 
    ##  Hypothesis Estimate Std. Error    z Pr(>|z|)    S 2.5 % 97.5 %
    ##       b5=b2      3.2      0.509 6.29   <0.001 31.6   2.2    4.2
    ## 
    ## Type:  response

``` r
# ✅ H3.2.3 Trust in banks predicts higher comfort ratings for actor=banks
m6.3 <- lmer(y ~ actors * trust_bank + context + moodstate + (1|participant) + (1|item), data=long)
avg_predictions(m6.3, by=c('trust_bank', 'actors'))
```

    ## 
    ##                  trust_bank       actors Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %
    ##  Extremely difficult        Banks            1.86      0.232  8.0   <0.001  49.5  1.40   2.31
    ##  Extremely difficult        Care Partner     4.55      0.232 19.6   <0.001 281.0  4.09   5.00
    ##  Extremely difficult        Clinicians       3.89      0.232 16.7   <0.001 206.6  3.44   4.35
    ##  Extremely easy             Banks            5.67      0.549 10.3   <0.001  80.7  4.59   6.74
    ##  Extremely easy             Care Partner     5.74      0.549 10.5   <0.001  82.6  4.66   6.81
    ##  Extremely easy             Clinicians       5.88      0.549 10.7   <0.001  86.7  4.81   6.96
    ##  Neither easy nor difficult Banks            3.89      0.275 14.1   <0.001 148.4  3.35   4.43
    ##  Neither easy nor difficult Care Partner     4.89      0.275 17.8   <0.001 233.1  4.36   5.43
    ##  Neither easy nor difficult Clinicians       4.52      0.275 16.4   <0.001 199.4  3.98   5.06
    ##  Somewhat difficult         Banks            3.36      0.257 13.1   <0.001 127.5  2.86   3.87
    ##  Somewhat difficult         Care Partner     5.51      0.257 21.4   <0.001 336.0  5.01   6.01
    ##  Somewhat difficult         Clinicians       4.68      0.257 18.2   <0.001 243.9  4.18   5.19
    ##  Somewhat easy              Banks            5.15      0.359 14.4   <0.001 153.0  4.45   5.86
    ##  Somewhat easy              Care Partner     5.42      0.359 15.1   <0.001 168.9  4.72   6.12
    ##  Somewhat easy              Clinicians       5.49      0.359 15.3   <0.001 173.2  4.79   6.19
    ## 
    ## Type:  response

``` r
avg_predictions(m6.3, by=c('trust_bank', 'actors'), hypothesis='b4=b1')
```

    ## 
    ##  Hypothesis Estimate Std. Error    z Pr(>|z|)    S 2.5 % 97.5 %
    ##       b4=b1     3.81      0.541 7.04   <0.001 38.9  2.75   4.87
    ## 
    ## Type:  response

#### ❌ H3.3 Prior requests for third-party aid in managing impulsive spending behaviors will be associated with higher comfort ratings across all third-party actors (versus those who have not requested help)

``` r
m7 <- lmer(y ~ actors * care_partner_help + context + moodstate + (1|participant) + (1|item), data=long)
hypotheses(avg_predictions(m7, by=c('actors', 'care_partner_help')), ~meandev, multcomp='holm')
```

    ## 
    ##   Hypothesis Estimate Std. Error      z Pr(>|z|)    S   2.5 %  97.5 %
    ##  (b1) - Mean  -1.3822      0.289 -4.782   <0.001 16.1 -2.1357 -0.6287
    ##  (b2) - Mean  -1.1958      0.542 -2.205   0.1371  2.9 -2.6092  0.2176
    ##  (b3) - Mean  -0.8159      0.299 -2.733   0.0427  4.5 -1.5942 -0.0376
    ##  (b4) - Mean   0.0804      0.289  0.278   1.0000 -0.0 -0.6731  0.8339
    ##  (b5) - Mean   0.0820      0.542  0.151   1.0000 -0.0 -1.3314  1.4954
    ##  (b6) - Mean   1.9027      0.299  6.372   <0.001 29.2  1.1244  2.6810
    ##  (b7) - Mean  -0.2202      0.289 -0.762   1.0000 -0.0 -0.9737  0.5333
    ##  (b8) - Mean   0.7301      0.542  1.347   0.7125  0.5 -0.6833  2.1435
    ##  (b9) - Mean   0.8188      0.299  2.742   0.0427  4.5  0.0405  1.5972

#### ✅ H4.1: Agreeableness will have a significant (non-directional) effect on level of comfort

``` r
m8 <- lmer(y ~ actors + context + moodstate + diagnosis_subtype + bfi_agreeableness + (1|participant) + (1|item), data=long)
car::Anova(m8, type=3)
```

    ## Analysis of Deviance Table (Type III Wald chisquare tests)
    ## 
    ## Response: y
    ##                     Chisq Df Pr(>Chisq)    
    ## (Intercept)        4.6115  1   0.031758 *  
    ## actors            57.4903  2  3.282e-13 ***
    ## context           65.3425  2  6.472e-15 ***
    ## moodstate          4.1509  1   0.041612 *  
    ## diagnosis_subtype  1.4787  4   0.830402    
    ## bfi_agreeableness  8.7463  1   0.003102 ** 
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

## Additional analysis;

``` r
# Main financial goal and vignettes

m9 <- lmer(y ~ actors + context  + moodstate + main_financial_goal + diagnosis_subtype + (1|participant) + (1|item), data=long)
car::Anova(m9, type=3)
```

    ## Analysis of Deviance Table (Type III Wald chisquare tests)
    ## 
    ## Response: y
    ##                       Chisq Df Pr(>Chisq)    
    ## (Intercept)         12.1435  1  0.0004926 ***
    ## actors              57.4900  2  3.282e-13 ***
    ## context             65.3422  2  6.473e-15 ***
    ## moodstate            4.1509  1  0.0416124 *  
    ## main_financial_goal  7.7232  5  0.1721660    
    ## diagnosis_subtype    1.2196  4  0.8748687    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
avg_predictions(m9, by='main_financial_goal')
```

    ## 
    ##                                                             main_financial_goal Estimate Std. Error    z Pr(>|z|)     S 2.5 % 97.5 %
    ##  To avoid accruing debt                                                             3.99      0.333 12.0   <0.001 107.4  3.34   4.64
    ##  To build up my savings/emergency fund/retirement                                   4.35      0.206 21.1   <0.001 326.1  3.94   4.75
    ##  To pay off debt (student loans, credit cards, etc.)                                3.81      0.214 17.8   <0.001 233.4  3.39   4.23
    ##  To reduce impulsive spending                                                       4.52      0.239 19.0   <0.001 263.8  4.06   4.99
    ##  To remember to pay my bills on time                                                4.27      0.369 11.6   <0.001 100.5  3.55   4.99
    ##  To work towards a large purchase (buying a house, car, tuition, business etc.)     4.11      0.312 13.2   <0.001 129.0  3.50   4.72
    ## 
    ## Type:  response

``` r
plot_predictions(m9, by=c('main_financial_goal', 'context'), dpi=300) + facet_wrap(~ context) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) + scale_x_discrete(labels = label_wrap(40))
```

    ## Warning: These arguments are not known to be supported for models of class `lmerMod`: dpi. These arguments are known to be valid: include_random, re.form, allow.new.levels, random.only. All arguments
    ## are still passed to the model-specific prediction function, but users are encouraged to check if the argument is indeed supported by their modeling package. Please file a request on Github if you
    ## believe that an unknown argument should be added to the `marginaleffects` white list of known arguments, in order to avoid raising this warning:
    ## https://github.com/vincentarelbundock/marginaleffects/issues

![](03.models_files/figure-gfm/unnamed-chunk-19-1.png)<!-- -->

``` r
env.2 <- loadEnvironment('../../../SSRI/data/finhealth_data.Rdata')
```

``` r
# Model BFI10 with main effects

m10bfi <- lmer(y ~ actors + context + moodstate + diagnosis_subtype + bfi_extraversion + bfi_agreeableness + bfi_conscientiousness + bfi_neuroticism + bfi_openness + (1|participant) + (1|item), data=long)

car::Anova(m10bfi, type=3)
```

    ## Analysis of Deviance Table (Type III Wald chisquare tests)
    ## 
    ## Response: y
    ##                         Chisq Df Pr(>Chisq)    
    ## (Intercept)            3.4774  1    0.06221 .  
    ## actors                57.4888  2  3.284e-13 ***
    ## context               65.3408  2  6.478e-15 ***
    ## moodstate              4.1508  1    0.04161 *  
    ## diagnosis_subtype      1.6199  4    0.80521    
    ## bfi_extraversion       0.0139  1    0.90630    
    ## bfi_agreeableness      5.2837  1    0.02153 *  
    ## bfi_conscientiousness  0.8985  1    0.34317    
    ## bfi_neuroticism        2.2746  1    0.13151    
    ## bfi_openness           1.5646  1    0.21099    
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

``` r
plot_predictions(m10bfi, condition=c('bfi_extraversion', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-21-1.png)<!-- -->

``` r
plot_predictions(m10bfi, condition=c('bfi_agreeableness', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-21-2.png)<!-- -->

``` r
plot_predictions(m10bfi, condition=c('bfi_conscientiousness', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-21-3.png)<!-- -->

``` r
plot_predictions(m10bfi, condition=c('bfi_neuroticism', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-21-4.png)<!-- -->

``` r
plot_predictions(m10bfi, condition=c('bfi_openness', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-21-5.png)<!-- -->

``` r
# Are people okay sharing things between stability vs illness?

m11 <- lmer(y ~ actors + (1|participant) + (1|item), data=env.2$long)
avg_predictions(m11, by='actors')
```

    ## 
    ##     actors Estimate Std. Error    z Pr(>|z|)   S 2.5 % 97.5 %
    ##  clinician     5.57      0.125 44.5   <0.001 Inf  5.32   5.81
    ##  family        5.00      0.125 39.9   <0.001 Inf  4.76   5.25
    ##  you           7.56      0.124 60.8   <0.001 Inf  7.31   7.80
    ## 
    ## Type:  response

``` r
# Model neuroticism between moodstate (as neuroticism has stepwise effect in prior work)

avg_predictions(m10bfi, variables='bfi_neuroticism', by='moodstate', hypothesis=difference~reference)
```

    ## 
    ##                  Hypothesis Estimate Std. Error    z Pr(>|z|)   S  2.5 % 97.5 %
    ##  (Symptomatic) - (Euthymic)    0.424      0.208 2.04   0.0416 4.6 0.0161  0.832
    ## 
    ## Type:  response

``` r
plot_predictions(m10bfi, condition=c('bfi_neuroticism', 'diagnosis_subtype'))
```

![](03.models_files/figure-gfm/unnamed-chunk-23-1.png)<!-- -->

``` r
long$trust_bank <- ordered(long$trust_bank, levels=c('Extremely difficult', 'Somewhat difficult', 'Neither easy nor difficult', 'Somewhat easy', 'Extremely easy'))
long$trust_carepartner <- ordered(long$trust_carepartner, levels=c('Extremely difficult', 'Somewhat difficult', 'Neither easy nor difficult', 'Somewhat easy', 'Extremely easy'))
long$trust_clinician <- ordered(long$trust_clinician, levels=c('Extremely difficult', 'Somewhat difficult', 'Neither easy nor difficult', 'Somewhat easy', 'Extremely easy'))
```
