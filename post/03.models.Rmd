---
title: "NIH Finhealth Survey - Models"
output:
  rmarkdown::github_document:
    html_preview: false
---

```{r class.source = 'fold-hide', warning=FALSE, message=FALSE}
library(brms)
library(tidybayes)
library(performance)
library(marginaleffects)
library(kableExtra)
```

## Load data

```{r}
load('data/NIH_survey.Rdata')
```

## Descriptive statistics

### Summary statistics of all variables

```{r, warning=FALSE, message=FALSE}
summary(wide)
```

### Means of outcome for each vignette

```{r, warning=FALSE, message=FALSE}
long %>%
        group_by(actors, context, moodstate) %>%
        summarize(
                Mean = mean(y, na.rm = TRUE),
                Median = median(y, na.rm = TRUE),
                SD = sd(y, na.rm = TRUE),
                ci = list(mean_cl_normal(y, conf.int = .95)),
                obs = n_distinct(participant)
        ) %>%
        unnest(c(ci)) %>%
        kable(digits = 2, "pipe")
```

## Modeling

### Unconditional means

```{r}
unconditional.means <- brm(y ~ 1 + (1|participant) + (1|item),
                           data=long,
                           warmup=1000,
                           iter=4000,
                           chains=2,
                           cores=4
                           )
summary(unconditional.means)
```

```{r}
performance::icc(unconditional.means, by_group=TRUE)
```
### Primary model

```{r}
#m1 <- brm(y ~ 1 + actors + context + moodstate + age + gender + diagnosis_subtype + diagnosis_age + PAD + hospitalization + education + income + trust_clinician + trust_bank + trust_carepartner + (1|participant) + (1|item), data=long, warmup=1000, iter=4000, chains=2, cores=4, file='m1')
m1 <- brm(file='m1.rds')
```


### H1.1 Stable vs symptomatic periods
```{r}

```