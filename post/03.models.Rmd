---
title: "NIH Finhealth Survey - Models"
output:
  rmarkdown::github_document:
    html_preview: false
---

```{r class.source = 'fold-hide', warning=FALSE, message=FALSE}
library(dplyr)
library(lme4)
library(performance)
library(marginaleffects)
library(kableExtra)
```

## Load data

```{r}
load('data/NIH_survey.Rdata')
```

## Descriptive statistics

### Summary statistics of all variables

```{r, warning=FALSE, message=FALSE}
summary(wide)
```

### Means of outcome for each vignette

```{r, warning=FALSE, message=FALSE}
long %>%
        group_by(actors, context, moodstate) %>%
        summarize(
                Mean = mean(y, na.rm = TRUE),
                Median = median(y, na.rm = TRUE),
                SD = sd(y, na.rm = TRUE),
                ci = list(mean_cl_normal(y, conf.int = .95)),
                obs = n_distinct(participant)
        ) %>%
        unnest(c(ci)) %>%
        kable(digits = 2, "pipe")
```

## Modeling

### Unconditional means

```{r}
unconditional.means <- lmer(y ~ 1 + (1|participant) + (1|item),
                           data=long
                           )
summary(unconditional.means)
```

```{r}
performance::icc(unconditional.means, by_group=TRUE)
```
### Primary model

```{r}
m1 <- lmer(y ~ 1 + actors + context + moodstate + age + gender + diagnosis_subtype + diagnosis_age + PAD + hospitalization + education + income + trust_clinician + trust_bank + trust_carepartner + bfi_agreeableness + (1|participant) + (1|item), data=long)
```


### H1.1 Stable vs symptomatic periods
```{r}
avg_predictions(m1, hypothesis= ~ sequential, by='moodstate', re.form=NULL)
```

### H1.2 Comfort ratings will be highest for shared spending behaviors during mood episodes
```{r}
avg_predictions(m1, by=c('moodstate', 'context'), re.form=NULL)
```

### H1.3 Spending restrictions during mood episodes vs. during stable periods


### H2.1 Comfort ratings will be lowest for spending restrictions

```{r}
avg_predictions(m1, by='context', re.form=NULL)
```

### H2.2 Higher comfort when sharing spending behaviors given PAD


### H2.3 Prior bankruptcy will increase comfort with spending restrictions


### H3.1 Comfort ratings will be highest for care partners

### H3.2 Trust in third parties will predict higher comfort ratings in those actors

### H3.3 Prior requests for help with impulsive spending associated with higher comfort ratings across actors (veruss those who have not requested help)

### H4.1 Agreeableness will have a significant (non-directional) effect on comfort ratings
