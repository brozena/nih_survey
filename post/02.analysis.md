NIH Finhealth Survey
================

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(lme4)
```

    ## Loading required package: Matrix
    ## 
    ## Attaching package: 'Matrix'
    ## 
    ## The following objects are masked from 'package:tidyr':
    ## 
    ##     expand, pack, unpack

``` r
library(buildmer)
library(performance)
library(marginaleffects)
library(emmeans)
```

    ## Welcome to emmeans.
    ## Caution: You lose important information if you filter this package's results.
    ## See '? untidy'

``` r
library(pbkrtest)
library(sjPlot)
```

    ## Install package "strengejacke" from GitHub (`devtools::install_github("strengejacke/strengejacke")`) to load all sj-packages at once!

``` r
library(kableExtra)
```

    ## 
    ## Attaching package: 'kableExtra'
    ## 
    ## The following object is masked from 'package:dplyr':
    ## 
    ##     group_rows

``` r
load('data/NIH_survey.Rdata')
```

## Descriptive statistics

### Vignettes

``` r
long %>%
        group_by(actors, context, moodstate) %>%
        summarize(
                Mean = mean(y, na.rm = TRUE),
                Median = median(y, na.rm = TRUE),
                SD = sd(y, na.rm = TRUE),
                ci = list(mean_cl_normal(y, conf.int = .95)),
                obs = n_distinct(participant)
        ) %>%
        unnest(c(ci)) %>%
        kable(digits = 2, "pipe")
```

    ## `summarise()` has grouped output by 'actors', 'context'. You can override using the `.groups` argument.

| actors      | context              | moodstate | Mean | Median |   SD |    y | ymin | ymax | obs |
|:------------|:---------------------|:----------|-----:|-------:|-----:|-----:|-----:|-----:|----:|
| banks       | planning_budgeting   | mood      | 3.81 |      4 | 3.20 | 3.81 | 3.52 | 4.09 | 500 |
| banks       | planning_budgeting   | stable    | 4.26 |      4 | 3.18 | 4.26 | 3.98 | 4.54 | 500 |
| banks       | restrict_spending_48 | mood      | 2.74 |      2 | 2.96 | 2.74 | 2.48 | 3.00 | 500 |
| banks       | restrict_spending_48 | stable    | 1.81 |      0 | 2.54 | 1.81 | 1.59 | 2.03 | 500 |
| banks       | share_spending       | mood      | 2.88 |      2 | 2.96 | 2.88 | 2.62 | 3.14 | 500 |
| banks       | share_spending       | stable    | 3.16 |      2 | 3.03 | 3.16 | 2.89 | 3.43 | 500 |
| carepartner | planning_budgeting   | mood      | 5.95 |      6 | 2.96 | 5.95 | 5.69 | 6.21 | 500 |
| carepartner | planning_budgeting   | stable    | 5.94 |      6 | 2.94 | 5.94 | 5.68 | 6.20 | 500 |
| carepartner | restrict_spending_48 | mood      | 4.58 |      5 | 3.22 | 4.58 | 4.30 | 4.86 | 500 |
| carepartner | restrict_spending_48 | stable    | 2.98 |      2 | 2.98 | 2.98 | 2.72 | 3.24 | 500 |
| carepartner | share_spending       | mood      | 5.41 |      6 | 3.06 | 5.41 | 5.14 | 5.68 | 500 |
| carepartner | share_spending       | stable    | 5.06 |      5 | 3.12 | 5.06 | 4.78 | 5.33 | 500 |
| clinicians  | planning_budgeting   | mood      | 5.40 |      6 | 3.00 | 5.40 | 5.13 | 5.66 | 500 |
| clinicians  | planning_budgeting   | stable    | 5.29 |      6 | 3.03 | 5.29 | 5.03 | 5.56 | 500 |
| clinicians  | restrict_spending_48 | mood      | 3.74 |      4 | 3.10 | 3.74 | 3.46 | 4.01 | 500 |
| clinicians  | restrict_spending_48 | stable    | 2.58 |      2 | 2.81 | 2.58 | 2.33 | 2.82 | 500 |
| clinicians  | share_spending       | mood      | 5.03 |      6 | 3.12 | 5.03 | 4.75 | 5.30 | 500 |
| clinicians  | share_spending       | stable    | 4.63 |      5 | 3.08 | 4.63 | 4.36 | 4.90 | 500 |

``` r
long %>% 
    summarize(Mean = mean(y, na.rm=TRUE),
              Median = median(y, na.rm=TRUE),
              SD = sd(y, na.rm=TRUE),
              obs = n_distinct(participant)
    )
```

    ## # A tibble: 1 × 4
    ##    Mean Median    SD   obs
    ##   <dbl>  <dbl> <dbl> <int>
    ## 1  4.18      4  3.26   500

## Modeling

### Unconditional means

``` r
unconditional.means <- lmer(y ~ 1 + (1|participant) + (1|item), data=long)
summary(unconditional.means)
```

    ## Linear mixed model fit by REML ['lmerMod']
    ## Formula: y ~ 1 + (1 | participant) + (1 | item)
    ##    Data: long
    ## 
    ## REML criterion at convergence: 41202.1
    ## 
    ## Scaled residuals: 
    ##     Min      1Q  Median      3Q     Max 
    ## -3.3243 -0.6615 -0.0134  0.6369  4.1194 
    ## 
    ## Random effects:
    ##  Groups      Name        Variance Std.Dev.
    ##  participant (Intercept) 4.257    2.063   
    ##  item        (Intercept) 1.583    1.258   
    ##  Residual                4.869    2.207   
    ## Number of obs: 8982, groups:  participant, 499; item, 18
    ## 
    ## Fixed effects:
    ##             Estimate Std. Error t value
    ## (Intercept)   4.1795     0.3115   13.42

``` r
check_model(unconditional.means)
```

    ## Failed to compute posterior predictive checks with `re_formula=NULL`.
    ##   Trying again with `re_formula=NA` now.

![](02.analysis_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

### Variable selection

``` r
maximal.model <- formula(maximal.model@model)
print(maximal.model)
```

    ## y ~ 1 + duration + context + actors + banked + trust_clinician + 
    ##     diagnosis_age + employment + ethnicity + marital + moodstate + 
    ##     cfpb_score + education + hospitalization + age + pay_later_service + 
    ##     gender + PAD + diagnosis_subtype + savings + income + hispanic + 
    ##     trust_carepartner + trust_bank + (1 | participant)

``` r
fit.maximal.model <- lmer(maximal.model, data=long)
```

    ## fixed-effect model matrix is rank deficient so dropping 9 columns / coefficients

## Model assessment

### Model quality

``` r
check_model(fit.maximal.model)
```

![](02.analysis_files/figure-gfm/unnamed-chunk-9-1.png)<!-- -->

``` r
icc(fit.maximal.model)
```

    ## # Intraclass Correlation Coefficient
    ## 
    ##     Adjusted ICC: 0.473
    ##   Unadjusted ICC: 0.296

``` r
check_singularity(fit.maximal.model)
```

    ## [1] FALSE

``` r
check_heteroscedasticity(fit.maximal.model)
```

    ## Warning: Heteroscedasticity (non-constant error variance) detected (p < .001).

``` r
model_performance(fit.maximal.model)
```

    ## # Indices of model performance
    ## 
    ## AIC       |      AICc |       BIC | R2 (cond.) | R2 (marg.) |   ICC |  RMSE | Sigma
    ## -----------------------------------------------------------------------------------
    ## 39800.039 | 39852.841 | 43131.799 |      0.670 |      0.373 | 0.473 | 2.165 | 2.228

## Main effects

## Interaction effects

### H4.1 Agreeableness will have a significant (non-directional) effect on level of comfort

``` r
h4.1 <- lmer(y ~ bfi_agreeableness * moodstate + actors + context + (1|participant) + (1|item), data=long)
```

``` r
contrast(emmeans(h4.1, ~ moodstate, infer=TRUE, digits=2))
```

    ## Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
    ## To enable adjustments, add the argument 'pbkrtest.limit = 8982' (or larger)
    ## [or, globally, 'set emm_options(pbkrtest.limit = 8982)' or larger];
    ## but be warned that this may result in large computation time and memory use.

    ## Note: D.f. calculations have been disabled because the number of observations exceeds 3000.
    ## To enable adjustments, add the argument 'lmerTest.limit = 8982' (or larger)
    ## [or, globally, 'set emm_options(lmerTest.limit = 8982)' or larger];
    ## but be warned that this may result in large computation time and memory use.

    ## NOTE: Results may be misleading due to involvement in interactions

    ##  contrast      estimate    SE  df z.ratio p.value
    ##  mood effect      0.212 0.104 Inf   2.037  0.0416
    ##  stable effect   -0.212 0.104 Inf  -2.037  0.0416
    ## 
    ## Results are averaged over the levels of: actors, context 
    ## Degrees-of-freedom method: asymptotic 
    ## P value adjustment: fdr method for 2 tests

``` r
sjPlot::plot_model(h4.1, type='int', terms='moodstate')
```

![](02.analysis_files/figure-gfm/unnamed-chunk-16-1.png)<!-- -->
